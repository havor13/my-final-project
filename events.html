<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Details</title>
  <link rel="stylesheet" href="styles/styles.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <!-- Banner Header -->
  <header class="site-header">
    <div class="banner">
      <h1>üéü Event Details</h1>
      <p class="author">Created by Sampson Havor</p>
    </div>
    <nav>
      <a href="index.html">Home</a> | 
      <a href="favorites.html">Favorites</a> | 
      <a href="events.html">Events</a>
    </nav>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <h2>Explore Your Selected Event</h2>
    <p>Find all the details, location, and options to save or share.</p>
  </section>

  <!-- Event Detail Card -->
  <section id="eventDetail" class="event-detail-card"></section>

  <!-- Footer -->
  <footer class="site-footer">
    <p>¬© 2026 Local Event Explorer | Author: Sampson Havor</p>
  </footer>

  <!-- Script -->
  <script src="scripts/api.js"></script>
  <script>
    async function loadEvent() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      // Show loading state
      document.getElementById("eventDetail").innerHTML = "<p>Loading event details...</p>";

      try {
        const event = await fetchEventById(id);
        if (!event) {
          document.getElementById("eventDetail").innerHTML = "<p>Sorry, event details could not be loaded.</p>";
          return;
        }

        const venueName = event.venue || "Unknown Venue";
        const mapUrl = getMapEmbedUrl(venueName);

        document.getElementById("eventDetail").innerHTML = `
          <img src="${event.image || 'placeholder.jpg'}" alt="${event.name}" class="event-banner">
          <h2>${event.name}</h2>
          <p><strong>Date:</strong> ${event.date}</p>
          <p><strong>Time:</strong> ${event.time}</p>
          <p><strong>Venue:</strong> ${venueName}</p>
          <div class="map-container">
            <iframe src="${mapUrl}" width="100%" height="300" style="border:0;" allowfullscreen></iframe>
          </div>
          <div class="card-actions">
            <button onclick='saveFavorite(${JSON.stringify(event)})'>‚≠ê Save to Favorites</button>
            <button onclick='shareEvent(${JSON.stringify(event)})'>üì§ Share Event</button>
          </div>
        `;
      } catch (err) {
        document.getElementById("eventDetail").innerHTML = "<p>Error loading event details.</p>";
      }
    }

    function saveFavorite(eventObj) {
      let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
      if (!favorites.find(fav => fav.id === eventObj.id)) {
        favorites.push(eventObj); // store full object
        localStorage.setItem("favorites", JSON.stringify(favorites));
        alert(`${eventObj.name} added to favorites!`);
      }
    }

    function shareEvent(eventObj) {
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({
          title: eventObj.name,
          text: `Check out this event: ${eventObj.name}`,
          url: url
        });
      } else {
        navigator.clipboard.writeText(url);
        alert("Event link copied to clipboard!");
      }
    }

    loadEvent();
  </script>
</body>
</html>
